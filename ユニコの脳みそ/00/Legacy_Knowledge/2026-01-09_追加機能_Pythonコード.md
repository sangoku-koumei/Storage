---
tags: [SNSé‹ç”¨, è‡ªå‹•åŒ–, Python, CodeSnippet, Threads, Reporting, 00, Legacy_Knowledge]
date: 2026-01-09
source: Implementation_Code
aliases: [Python_Addon_Features, Pythonè¿½åŠ æ©Ÿèƒ½ã‚³ãƒ¼ãƒ‰]
---

# [[2026-01-09_è¿½åŠ æ©Ÿèƒ½_Pythonã‚³ãƒ¼ãƒ‰]]
# è¿½åŠ æ©Ÿèƒ½å®Ÿè£…ã‚³ãƒ¼ãƒ‰ (Pythonç·¨)

[[00_çŸ¥è­˜ãƒãƒƒãƒ—|â¬…ï¸ 00ï¼šçŸ¥è­˜ãƒãƒƒãƒ—ã¸æˆ»ã‚‹]]

## Keywords & Tags
#SNSé‹ç”¨ #è‡ªå‹•åŒ– #Python #CodeSnippet #Threads #Reporting #Legacy_Knowledge #00

`app` ãƒ•ã‚©ãƒ«ãƒ€å†…ã«æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ã¨é€£æºã•ã›ã¾ã™ã€‚

---

## 1. ThreadsåŒæ™‚æŠ•ç¨¿æ©Ÿèƒ½ (`scheduler.py` æ”¹ä¿®æ¡ˆ)

æŠ•ç¨¿å®Ÿè¡Œæ™‚ã«ã€Threads APIã‚‚å©ãã‚ˆã†ã« `app/scheduler.py` ã‚’ä¿®æ­£ã—ã¾ã™ã€‚
â€» `app/threads_client.py`ï¼ˆå‰å›ä½œæˆï¼‰ãŒå­˜åœ¨ã™ã‚‹å‰æã§ã™ã€‚

### å¤‰æ›´ç®‡æ‰€ã‚¤ãƒ¡ãƒ¼ã‚¸ (`app/scheduler.py`)

```python
from app.threads_client import ThreadsClient # è¿½åŠ 

# (ä¸­ç•¥)

def post_media_task(post_id: int):
    # ... (æ—¢å­˜ã®InstagramæŠ•ç¨¿å‡¦ç†) ...
    
    # InstagramæŠ•ç¨¿æˆåŠŸå¾Œ
    if post.status == "POSTED":
        try:
            # Threadsã«ã‚‚æŠ•ç¨¿ (ç°¡æ˜“ç‰ˆ: åŒã˜ãƒ†ã‚­ã‚¹ãƒˆã‚’æŠ•ç¨¿)
            # â€» ç”»åƒæ·»ä»˜ã¯Threads API v1ã§ã¯è¤‡é›‘ãªãŸã‚ã€ä»Šå›ã¯ã€Œãƒ†ã‚­ã‚¹ãƒˆ + ã‚¤ãƒ³ã‚¹ã‚¿ã¸ã®ãƒªãƒ³ã‚¯ã€ã‚’æ¨å¥¨
            threads_text = f"{post.caption}\n\nğŸ‘‡ ç”»åƒã¯Instagramã§ãƒã‚§ãƒƒã‚¯ï¼\nhttps://www.instagram.com/p/{media_id}/"
            
            # ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆæœŸåŒ– (Treadsã®ãƒˆãƒ¼ã‚¯ãƒ³ãŒå¿…è¦)
            threads = ThreadsClient(
                access_token=settings.THREADS_ACCESS_TOKEN, 
                user_id=settings.THREADS_USER_ID
            )
            
            threads.reply_to_thread(media_id="me", text=threads_text) # "me" å®› = æ–°è¦æŠ•ç¨¿
            log_event("INFO", "Scheduler", "Threads Posted", f"Post ID: {post.id}")
            
        except Exception as e:
            log_event("WARN", "Scheduler", "Threads Post Failed", str(e))
```

---

## 2. ãƒ¬ãƒãƒ¼ãƒˆè‡ªå‹•é€ä¿¡æ©Ÿèƒ½ (`app/report_sync.py`)

1æ—¥ã®çµ‚ã‚ã‚Šã«ãƒ‡ãƒ¼ã‚¿ã‚’GASã¸é€ä¿¡ã™ã‚‹æ–°ã—ã„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã™ã€‚
`app/scheduler.py` ã‹ã‚‰å®šæœŸå‘¼ã³å‡ºã—ï¼ˆä¾‹ï¼šæ¯æ—¥23:59ï¼‰ã™ã‚‹ã‚ˆã†ã«è¨­å®šã—ã¾ã™ã€‚

### æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«: `app/report_sync.py`

```python
import requests
from datetime import datetime
from app.config import settings
from app.db import SessionLocal
from app.models import IGAccount, ScheduledPost
from app.utils_logging import log_event

# GASã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸã€Œã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªURLã€ã‚’ã“ã“ã«è¨­å®š
GAS_WEBHOOK_URL = "https://script.google.com/macros/s/xxxxxxxxx/exec"

def sync_daily_report():
    """
    ãã®æ—¥ã®å®Ÿç¸¾ã‚’é›†è¨ˆã—ã¦GASã«é€ä¿¡ã™ã‚‹
    """
    db = SessionLocal()
    try:
        # ä»Šæ—¥ã®æ—¥ä»˜ç¯„å›²
        today = datetime.now().date()
        
        # 1. æŠ•ç¨¿æ•°ã®é›†è¨ˆ
        posts_count = db.query(ScheduledPost).filter(
            ScheduledPost.status == "POSTED",
            ScheduledPost.updated_at >= today # ç°¡æ˜“çš„ãªåˆ¤å®š
        ).count()
        
        # 2. ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ãƒ»ã„ã„ã­æ•°ã®å–å¾— (Instagram API)
        # â€» ã“ã“ã§ã¯ç°¡æ˜“çš„ã«APIã‚’å©ãã‚³ãƒ¼ãƒ‰ã‚’ã‚¤ãƒ¡ãƒ¼ã‚¸ã§è¨˜è¿°
        account = db.query(IGAccount).first() # æœ€åˆã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
        if not account:
            return

        # (ã“ã“ã§æœ¬æ¥ã¯ meta_client.get_insights() ãªã©ã‚’å‘¼ã¶)
        likes_gained = 150 # ä»®ã®æ•°å€¤
        followers_gained = 5 # ä»®ã®æ•°å€¤

        # 3. ãƒ‡ãƒ¼ã‚¿é€ä¿¡
        payload = {
            "account_name": account.name,
            "likes_gained": likes_gained,
            "followers_gained": followers_gained,
            "posts_count": posts_count
        }
        
        resp = requests.post(GAS_WEBHOOK_URL, json=payload)
        
        if resp.status_code == 200:
            log_event("INFO", "ReportSync", "Success", "Sent report to GAS")
        else:
            log_event("ERROR", "ReportSync", "Failed", f"Status: {resp.status_code}")

    except Exception as e:
        log_event("ERROR", "ReportSync", "Error", str(e))
    finally:
        db.close()

if __name__ == "__main__":
    sync_daily_report()
```

---

## ğŸ“ å°å…¥æ‰‹é †

1.  **Threadsç”¨è¨­å®š**: `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã« `THREADS_ACCESS_TOKEN` ã¨ `THREADS_USER_ID` ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚
2.  **GAS URLè¨­å®š**: `report_sync.py` ã® `GAS_WEBHOOK_URL` ã«ã€GASå´ã§ç™ºè¡Œã—ãŸURLã‚’æ›¸ãè¾¼ã‚“ã§ãã ã•ã„ã€‚
3.  **ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ç™»éŒ²**: `app/scheduler.py` ã® `start_scheduler` é–¢æ•°å†…ã«ã€ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¦æ¯æ—¥å®Ÿè¡Œã•ã›ã¾ã™ã€‚

```python
# æ¯æ—¥23:55ã«ãƒ¬ãƒãƒ¼ãƒˆé€ä¿¡
scheduler.add_job(sync_daily_report, 'cron', hour=23, minute=55)
```
