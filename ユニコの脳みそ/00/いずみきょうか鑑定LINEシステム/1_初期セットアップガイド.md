---
tags: [Guide, Setup, Initial_Setup, IzumiKyoka, 00]
date: 2026-01-20
source: ユニコの脳みそ/00
aliases: [1_初期セットアップガイド, Initial_Setup_Guide]
---

# [[00_知識マップ]]
# 1️⃣ 初期セットアップガイド

**所要時間：40分**

スプレッドシート、GAS、OpenAI APIの基本設定を行います。

---

## ✅ このステップでやること

```
☐ Googleスプレッドシート作成
☐ GASコード貼り付け
☐ OpenAI API設定
☐ 占い師用Gmail作成
☐ 初期データ投入
☐ トリガー設定
☐ 動作確認
```

---

## 📝 Step 1-1: スプレッドシート作成（5分）

### 1. 新規スプレッドシート作成

1. [Google スプレッドシート](https://sheets.google.com/) にアクセス
2. 「新規作成」をクリック
3. 名前を変更：**「占いシステム_本番」**

### 2. Apps Script エディタを開く

1. メニューバー →「拡張機能」→「Apps Script」
2. 新しいタブで Apps Script エディタが開く
3. プロジェクト名を変更：**「占いシステム」**

✅ 完了！次へ

---

## 💻 Step 1-2: GASコード設置（10分）

### 1. 既存コードを削除

Apps Script エディタで：
- デフォルトの `function myFunction() {...}` を**すべて削除**

### 2. Code.gs をコピー＆ペースト

1. 本リポジトリの `Code.gs` を開く
2. **すべて**コピー（Ctrl+A → Ctrl+C）
3. Apps Script エディタに貼り付け（Ctrl+V）
4. **保存**（Ctrl+S）

### 3. 初回権限承認

1. 関数選択ドロップダウンから `setupSheets` を選択
2. 「実行」ボタン（▶️）をクリック
3. 「承認が必要です」ダイアログが表示される
4. **「権限を確認」**をクリック
5. Googleアカウントを選択
6. **「このアプリは確認されていません」と表示される場合**：
   - 「詳細」をクリック
   - 「[プロジェクト名]（安全ではないページ）に移動」をクリック
   - 「許可」をクリック
7. 実行完了を待つ（20秒程度）

### 4. 初期化の確認

スプレッドシートに戻り、以下のシートが作成されていることを確認：

```
✓ users
✓ applications
✓ deadlines
✓ states
✓ readings
✓ email_templates
✓ send_queue
✓ consult_requests
✓ consult_decisions
✓ appointments
✓ links
✓ config
✓ products
✓ payments
✓ ai_prompts         ← AI鑑定用
✓ ai_settings        ← AI設定用
✓ ai_reading_schedule ← AI実行管理
✓ form_tokens        ← フォーム認証用（新規）
✓ logs_2025-11
```

✅ すべて作成されていればOK！

---

## 🔑 Step 1-3: OpenAI API設定（10分）

### 1. OpenAIアカウント作成

1. [OpenAI Platform](https://platform.openai.com/) にアクセス
2. アカウント作成（メールアドレス登録）
3. ログイン

### 2. APIキー取得

1. 左サイドバーから「API keys」をクリック
2. 「Create new secret key」をクリック
3. 名前を入力：**「占いシステム」**
4. **APIキーをコピー**（`sk-proj-...` で始まる文字列）
   - ⚠️ 一度しか表示されないので必ずコピー！

### 3. 課金設定

1. 左サイドバーから「Settings」→「Billing」
2. 「Add payment method」でクレジットカード登録
3. 「Usage limits」を設定：
   - **Monthly budget**: $10（推奨）
   - Email alerts: チェックON

### 4. スプレッドシートに設定

1. スプレッドシートの `config` シートを開く
2. 以下の行を追加（最終行の次に）：

```
openai_api_key	sk-proj-xxxxxxxxxx	OpenAI API Key
openai_model	gpt-4o-mini	使用するモデル
```

**注意**: `sk-proj-xxxxxxxxxx` を実際のAPIキーに置き換える

✅ OpenAI設定完了！

---

## 📧 Step 1-4: 占い師用Gmail作成（5分）

### 1. 専用Gmailアカウント作成

1. [Gmail作成](https://accounts.google.com/signup) にアクセス
2. 情報入力：
   ```
   姓: いずみ
   名: きょうか
   ユーザー名: izumi.kyouka.uranai
   （または好きな名前）
   ```
3. パスワード設定
4. 電話番号認証
5. 完了！

**推奨ユーザー名例**：
- `izumi.kyouka.uranai@gmail.com`
- `izumikyouka.fortune@gmail.com`
- `uranai.izumi@gmail.com`

### 2. config シートに設定

`config` シートで以下を変更：

```
sender_email	izumi.kyouka.uranai@gmail.com	送信元メール
sender_name	いずみきょうか	送信者名
ops_email	izumi.kyouka.uranai@gmail.com	運営通知先
preview_to	izumi.kyouka.uranai@gmail.com	プレビュー宛先
```

**重要**: 最初は `preview_mode = TRUE` のままにする（テスト用）

✅ メール設定完了！

---

## 📊 Step 1-5: 初期データ投入（5分）

### 1. products シート（商品マスター）

1. `商品マスターサンプル.txt` を開く
2. **products シート部分**をコピー
3. `products` シートのA1セルを選択
4. 貼り付け（Ctrl+V）

→ 商品一覧が表示される

### 2. ai_prompts シート（プロンプト管理）

1. `完全スプシ管理_サンプルデータ.txt` を開く
2. **ai_prompts シート部分**をコピー
3. `ai_prompts` シートのA1セルを選択
4. 貼り付け

→ プロンプトが表示される

### 3. ai_settings シート（AI設定）

1. 同じファイルから **ai_settings シート部分**をコピー
2. `ai_settings` シートのA1セルを選択
3. 貼り付け

### 4. form_tokens シート（新規作成）

このシートは手動で作成します：

1. 新しいシートを追加
2. 名前を `form_tokens` に変更
3. A1セルから以下を入力：

```
token	user_id	form_type	created_at	used_at	used
```

このシートはフォームの1回限り認証に使用します。

✅ 初期データ完了！

---

## ⚙️ Step 1-6: トリガー設定（3分）

### 1. tick() トリガー設定

1. Apps Script エディタに戻る
2. 関数選択から `setupTriggers` を選択
3. 「実行」ボタンをクリック
4. 「トリガー設定完了」のアラートが表示される

### 2. 確認

1. 左サイドバーの「トリガー」アイコン（⏰）をクリック
2. 以下のトリガーが表示されることを確認：
   ```
   関数: tick
   イベントソース: 時間主導型
   時間ベースのトリガーのタイプ: 分ベースのタイマー
   時間の間隔: 1分おき
   ```

✅ トリガー設定完了！

**これで毎分自動実行されます！**

---

## ✅ Step 1-7: 動作確認（2分）

### 1. テストユーザーを作成

`users` シートに以下を追加：

```
TEST_001	テスト太郎	test@example.com	1990-05-15		2025-11-03 10:00:00	FALSE	テスト
```

### 2. config シートを確認

以下の設定になっていることを確認：

```
freeze_all: FALSE
freeze_sending: FALSE
preview_mode: TRUE (テスト中はTRUE)
```

### 3. ログ確認

`logs_2025-11` シートを開いて、ログが記録されているか確認

もし何も表示されない場合：
1. Apps Script エディタで `tick` 関数を手動実行
2. ログに記録される

✅ 動作確認完了！

---

## 🎯 完了チェックリスト

初期セットアップが完了したか確認：

- [ ] スプレッドシート作成完了
- [ ] Code.gs 貼り付け完了
- [ ] 全シート作成を確認（19シート）
- [ ] OpenAI APIキー取得＆設定
- [ ] 占い師用Gmail作成＆設定
- [ ] 初期データ投入完了
- [ ] トリガー設定完了
- [ ] ログに記録が表示される

**すべて✅なら次へ！**

---

## 📌 重要な設定値まとめ

### config シート（現時点）

```
freeze_all: FALSE
freeze_sending: FALSE
preview_mode: TRUE (まだテスト中)
preview_to: [あなたのメール]
sender_email: izumi.kyouka.uranai@gmail.com
sender_name: いずみきょうか
ops_email: izumi.kyouka.uranai@gmail.com
timezone: Asia/Tokyo
openai_api_key: sk-proj-xxxxxxxxxx
openai_model: gpt-4o-mini
```

---

## 🆘 トラブルシューティング

### Q: シートが作成されない

**対処**:
1. Apps Script の「実行数」を確認
2. エラーがある場合、権限を再承認
3. `setupSheets()` を再実行

### Q: OpenAI APIキーのエラー

**対処**:
1. キーが正しいか確認（`sk-proj-` で始まる）
2. OpenAIの課金設定を確認
3. 使用量制限を確認

### Q: トリガーが設定されない

**対処**:
1. `deleteTriggers()` を実行
2. `setupTriggers()` を再実行
3. Apps Script の「トリガー」画面で手動作成

---

## ✨ 次のステップ

初期セットアップが完了しました！

**→ [2_Googleフォーム設定ガイド.md](./2_Googleフォーム設定ガイド.md) へ進む**

次は、無料鑑定・有料鑑定・無料相談の各フォームを作成します！

