---
tags: [Plan, Task_Allocation, Setup, IzumiKyoka, 00]
date: 2026-01-20
source: ユニコの脳みそ/00
aliases: [セットアップ作業分担計画, Setup_Task_Plan]
---

[[00_知識マップ]]

# セットアップ作業分担計画

本書は、「いずみきょうか鑑定LINEシステム」を導入する際に、GASやAPIキーなどの機密情報を扱う作業と、それ以外の作業を切り分け、効率的に外注を活用するための指示書です。  
以下の手順・指示をそのまま外注メンバーと共有できます。

---

## 1. 全体フローの整理

- Step 1: 初期セットアップ（スプレッドシート・GAS・API設定）
- Step 2: Googleフォーム設定
- Step 3: プロライン × PayPal 決済連携
- Step 4: LINE公式アカウント連携
- Step 5: 運用開始前チェック

このうち、GAS編集・APIキー設定・Webhookデプロイなどの「Google Apps Script／APIキーを扱う工程」はご本人が担当し、それ以外の画面作成やコンテンツ入力作業を外注担当に依頼します。

---

## 2. ご本人が担当する作業（GAS・APIキー関連）

### 2-1. Googleアカウントと基本ツール準備
1. 運用用のGoogleアカウントでログイン（推奨：占い師専用Gmail）。
2. Googleスプレッドシートを新規作成し、名称を「占いシステム_本番」に変更。
3. 「拡張機能」→「Apps Script」からエディタを開き、プロジェクト名を「占いシステム」に変更。

### 2-2. GASコードの設置と初期化
1. リポジトリの`Code.gs`全体をコピーし、Apps Scriptエディタに貼り付けて保存。
2. 関数`setupSheets`を実行して権限承認を完了させ、全シートが生成されたことを確認。
3. 関数`setupTriggers`を実行し、`tick`トリガー（1分ごと）が設定されたか確認。

### 2-3. OpenAI APIおよびメール設定
1. OpenAIダッシュボードでAPIキーを発行し、課金設定（上限額）を完了。
2. スプレッドシート`config`シートに以下を入力・更新。
   - `openai_api_key`: 発行したAPIキー
   - `openai_model`: 既定値（例: `gpt-4o-mini`）
   - `sender_email` / `sender_name` / `ops_email` / `preview_to`
3. テスト期間中は`preview_mode = TRUE`のままにする。

### 2-4. 初期データの保護が必要な操作
1. `products` / `ai_prompts` / `ai_settings`シートへ提供ファイルの内容を貼り付け。
2. `form_tokens`シートを手動で作成し、ヘッダー行（`token`, `user_id`, `form_type`, `created_at`, `used_at`, `used`）を入力。

### 2-5. フォーム送信トリガー設定（Step 2-4）
外注がフォームを作成し連携設定を終えたら、以下を**ご本人が**Apps Scriptで設定。
1. トリガー画面で「トリガーを追加」→`onFreeReadingFormSubmit` / `onPaidReadingFormSubmit` / `onConsultFormSubmit`をそれぞれ「フォーム送信時」で登録。
2. エラー通知設定を「毎日通知」にして保存。

### 2-6. Webhook／Webアプリのデプロイと登録
1. `Code.gs`内の`doPost`や`handleProlineWebhook_`などWebhook関連ロジックを確認（デフォルトで実装済み）。
2. Apps Scriptの「デプロイ」→「新しいデプロイ」→種類「ウェブアプリ」で公開。
   - 実行ユーザー: 自分
   - アクセス権: 全員
3. 発行されたWebアプリURLを控える。
4. プロライン管理画面（決済設定 > Webhook）の入力欄にログインし、ご自身で上記URLを登録・保存する。
5. 必要に応じてテスト配信を実行し、`logs_YYYY-MM`に受信記録が出るか確認する。

### 2-7. 決済テストとログ確認
1. テスト決済（少額）または`testTokenGeneration`等のテスト関数実行でトークン発行を確認。
2. `logs_YYYY-MM`シートでログが出力されているか確認。
3. `preview_mode = TRUE`のままメール送信動作をテストし、想定どおりのメールが`preview_to`に届くかチェック。

### 2-8. 本番切り替え時
1. `preview_mode = FALSE`に変更。
2. 必要に応じて`freeze_all`を使って緊急停止可能なことをメモ。

---

## 3. 外注に任せる作業と指示内容

以下は、GASやAPIキーに触れずに実行できる工程です。外注先へそのまま提示できる詳細指示を記載します。

### 3-1. Googleフォーム作成（Step 2）
- 参照資料: `2_Googleフォーム設定ガイド.md`
- 依頼内容:
  - 「無料鑑定」「有料鑑定」「無料相談」フォームの新規作成
  - 各質問内容をガイドどおりに設定
  - 回答先を指定のスプレッドシートに接続（すべて同一スプレッドシート）
  - フォームURLを取得し、`links`シートへ追記
  - 完了後、フォームID／URL一覧と確認用スクリーンショットを共有

### 3-2. プロライン×PayPal設定（Step 3）
- 参照資料: `3_プロライン×PayPal連携ガイド.md`
- 依頼内容:
  - プロライン管理画面で商品を登録（商品名・価格・説明は資料どおり）
  - PayPal.Meリンクを各商品ボタンに設定（ご本人支給のリンクを使用）
  - 購入後メッセージで有料鑑定フォームへ誘導するテキストを設定
  - Webhook欄は空欄のまま保存し、入力箇所のスクリーンショットを共有（実際の登録はご本人が実施）
  - テスト購入（サンドボックスもしくは少額決済）後の画面キャプチャを添付

### 3-3. LINE公式アカウント設定（Step 4）
- 参照資料: `4_LINE完全統合ガイド.md`
- 依頼内容:
  - LINE公式アカウントのプロフィール・あいさつメッセージ整備
  - プロラインフリーとの連携設定（友だち追加時の自動配信、応答メッセージなど）
  - リッチメニューをデザインし、ボタンリンク先（フォームURL、決済ページ等）を設定
  - 自動応答の文面を資料どおりに登録
  - QRコード・友だち追加リンクを取得し共有

### 3-4. 初期データの整形（必要に応じて）
- 参照資料: `商品マスターサンプル.txt`, `完全版_初期データ一括投入.txt`
- 依頼内容:
  - 提供するテンプレートをもとに商品情報やメールテンプレートの文言を微調整
  - 文言変更が発生した場合は変更点一覧をまとめる

### 3-5. マニュアル・チェックリストの整備
- 参照資料: `セットアップ完了チェックリスト.md`, `5_運用マニュアル.md`
- 依頼内容:
  - 各ステップ完了時のスクリーンショットとチェックリストのチェック結果を記録
  - 運用前に実施するテストケース（フォーム送信、決済、LINE自動応答）を実行し、結果をレポート化

---

## 4. 外注メンバーへの共有テンプレート

以下のテンプレートをコピーして、担当者ごとに必要な箇所を埋めて送付してください。

```
【プロジェクト概要】
いずみきょうか鑑定LINEシステムの初期構築をお願いします。
GASとAPIキー関連作業はクライアント側で実施済み／実施予定です。

【担当してほしい範囲】
- Googleフォーム作成（無料鑑定／有料鑑定／無料相談）
- プロライン管理画面での商品登録とPayPalリンク設定
- LINE公式アカウントのリッチメニュー・自動応答設定
- （必要に応じて）初期データ文面の微調整・整形

【参照マニュアル】
- 2_Googleフォーム設定ガイド.md
- 3_プロライン×PayPal連携ガイド.md
- 4_LINE完全統合ガイド.md
- セットアップ完了チェックリスト.md

【共有済み情報】
- スプレッドシートURL:
- フォーム回答連携先シート: （シート名を列挙）
- PayPal.Meリンク一覧:
- Webhook URL（プロライン利用時）:

【納品物】
- 作業手順メモまたはチェックリスト（Googleドキュメントで可）
- 各設定画面のスクリーンショット
- フォームURL／リッチメニュー設定内容の一覧

ご不明点があれば随時ご連絡ください。
```

---

## 5. 進行管理とチェックポイント

- 外注着手前に、必要なログイン情報・権限（スプレッドシート閲覧権限、LINE公式アカウント管理権限など）を付与する。
- 各ステップ完了時に、外注側からエビデンス（スクリーンショット・操作ログ）を回収し、`セットアップ完了チェックリスト.md`で自己確認する。
- GAS側でトリガーやWebhookを設定した後は、テストデータで`logs_YYYY-MM`・`send_queue`・メール送信状況を確認する。
- 問題が起きた場合は`FAQ.md`や`GAS実装仕様書.md`の該当箇所を参照し、必要に応じて`freeze_all = TRUE`で一時停止する。

---

## 6. 次のアクション

1. 本書に沿って、ご本人担当分（Section 2）を順に進める。  
2. 外注向けテンプレート（Section 4）に情報を埋めて共有し、作業開始を依頼。  
3. 外注からの納品物を受領後、トリガー設定・Webhookデプロイ・テスト送信を実施。  
4. `preview_mode = FALSE`へ切り替え、本番運用を開始。

---

この計画書を活用し、機密性の高い工程を手元で管理しながら、重たい作業は外注に任せてスムーズにシステムを構築してください。

