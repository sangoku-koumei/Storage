---
tags: [Guide, Setup, GoogleForm, IzumiKyoka, 00]
date: 2026-01-20
source: ユニコの脳みそ/00
aliases: [2_Googleフォーム設定ガイド, GoogleForm_Setup]
---

# [[00_知識マップ]]
# 2️⃣ Googleフォーム設定ガイド

**所要時間：30分**

3種類のフォーム（無料鑑定・有料鑑定・無料相談）を作成し、それぞれ適切に設定します。

---

## ✅ このステップでやること

```
☐ 無料鑑定フォーム作成
☐ 有料鑑定フォーム作成（トークン認証・1回限り）
☐ 無料相談フォーム作成
☐ スプレッドシート連携
☐ フォーム送信トリガー設定
```

---

## 📝 フォームの種類と特徴

| フォーム | アクセス方法 | 回答制限 | 相談内容 |
|---------|------------|----------|---------|
| **無料鑑定** | LINE→直接 | 制限なし | あり |
| **有料鑑定** | PayPal決済後メールでURL | **1回のみ** | あり |
| **無料相談** | LINE→直接 | 制限なし | 候補日時選択 |

---

## 📋 Form 1: 無料鑑定フォーム（10分）

### Step 2-1-1: フォーム作成

1. [Googleフォーム](https://forms.google.com/) で新規作成
2. タイトル：**「無料鑑定お申し込み」**
3. 説明文：
   ```
   いずみきょうかの無料鑑定にお申し込みいただき
   ありがとうございます。

   以下の項目をご記入ください。
   鑑定結果は3日以内にメールでお届けします。
   ```

### Step 2-1-2: 質問を追加

**質問1: お名前** *
```
形式: 短答式テキスト
必須: ON
```

**質問2: メールアドレス** *
```
形式: 短答式テキスト
必須: ON
データの検証: ON
  ↓
「メールアドレス」を選択
```

**質問3: 生年月日** *
```
形式: 日付
必須: ON
```

**質問4: どのようなことを知りたいですか？** *
```
形式: 段落
必須: ON
説明: 恋愛、仕事、人間関係など、具体的にお書きください。
```

### Step 2-1-3: 回答先を設定

1. 「回答」タブをクリック
2. スプレッドシートアイコン（緑色）をクリック
3. 「既存のスプレッドシートを選択」
4. 占いシステムのスプレッドシートを選択
5. 「作成」

→ `無料鑑定フォーム` シートが自動作成される

### Step 2-1-4: フォームURLを取得

1. 「送信」ボタンをクリック
2. リンクアイコンをクリック
3. **「URLを短縮」をOFF**にする
4. URLをコピー

例: `https://docs.google.com/forms/d/e/xxxxx/viewform`

### Step 2-1-5: links シートに登録

`links` シートに追加：

```
L9002	無料鑑定申込みフォーム	https://docs.google.com/forms/d/e/xxxxx/viewform	LINE直接
```

✅ 無料鑑定フォーム完了！

---

## 💳 Form 2: 有料鑑定フォーム（トークン認証・1回限り）（15分）

### Step 2-2-1: フォーム作成

1. [Googleフォーム](https://forms.google.com/) で新規作成
2. タイトル：**「有料鑑定 ご相談内容記入フォーム」**
3. 説明文：
   ```
   有料鑑定をお申し込みいただき、ありがとうございます。

   このフォームは1回のみ回答可能です。
   じっくりお考えの上、ご記入ください。

   鑑定結果は7日以内にメールでお届けします。
   ```

### Step 2-2-2: 質問を追加

**質問1: 認証トークン**（隠しフィールド）
```
形式: 短答式テキスト
必須: ON
説明: ※このフィールドは自動入力されます
```

**質問2: お名前** *
```
形式: 短答式テキスト
必須: ON
```

**質問3: メールアドレス** *
```
形式: 短答式テキスト
必須: ON
データの検証: メールアドレス
```

**質問4: ご相談内容** *
```
形式: 段落
必須: ON
説明: 
どのようなことを知りたいですか？
恋愛、仕事、人間関係、将来のことなど、
具体的にお書きください。

【記入例】
・今年中に結婚できるでしょうか
・転職のタイミングを知りたい
・気になる人との相性を知りたい
```

**質問5: 特に詳しく知りたいこと**（任意）
```
形式: 段落
必須: OFF
説明: 
特に重点的に鑑定してほしいことがあれば
お書きください（任意）
```

### Step 2-2-3: 回答先を設定

1. 「回答」タブ
2. スプレッドシートアイコンをクリック
3. 「既存のスプレッドシートを選択」
4. 同じスプレッドシートを選択

→ `有料鑑定フォーム` シートが自動作成される

### Step 2-2-4: フォームURLを取得

1. 「送信」ボタンをクリック
2. リンクアイコンをクリック
3. URLをコピー

**このURLは直接使わない！**
トークン付きURLで送信するため、ベースURLとして保管

### Step 2-2-5: links シートに登録

`links` シートに追加：

```
L9003	有料鑑定フォーム（ベースURL）	https://docs.google.com/forms/d/e/xxxxx/viewform	トークン認証用
```

### Step 2-2-6: フォーム制限スクリプト追加

**重要**: このフォームは**1回限り**回答可能にします。

`Code.gs` に以下の関数が既に含まれています：

```javascript
/**
 * 有料鑑定フォーム送信時の処理
 */
function onPaidReadingFormSubmit(e) {
  // トークン検証
  // 1回限り制御
  // スプシに記録
}
```

このトリガーは後ほど設定します（Step 2-4）。

✅ 有料鑑定フォーム完了！

---

## 📅 Form 3: 無料相談フォーム（5分）

### Step 2-3-1: フォーム作成

1. [Googleフォーム](https://forms.google.com/) で新規作成
2. タイトル：**「無料相談（Zoom）お申し込み」**
3. 説明文：
   ```
   無料相談（Zoom 30分）にお申し込みいただき
   ありがとうございます。

   ご都合の良い日時候補を3つお選びください。
   こちらで調整の上、確定日時をご連絡します。

   ※相談は48時間以内のお申し込みに限ります
   ```

### Step 2-3-2: 質問を追加

**質問1: お名前** *
```
形式: 短答式テキスト
必須: ON
```

**質問2: メールアドレス** *
```
形式: 短答式テキスト
必須: ON
データの検証: メールアドレス
```

**質問3: 候補日時 第1希望** *
```
形式: 日付と時刻
必須: ON
説明: 第1希望の日時をお選びください
```

**質問4: 候補日時 第2希望** *
```
形式: 日付と時刻
必須: ON
説明: 第2希望の日時をお選びください
```

**質問5: 候補日時 第3希望** *
```
形式: 日付と時刻
必須: ON
説明: 第3希望の日時をお選びください
```

**質問6: ご相談内容**（任意）
```
形式: 段落
必須: OFF
説明: 
事前にお伝えしておきたいことがあれば
お書きください（任意）
```

### Step 2-3-3: 回答先を設定

1. 「回答」タブ
2. スプレッドシートアイコンをクリック
3. 「既存のスプレッドシートを選択」
4. 同じスプレッドシートを選択

→ `無料相談フォーム` シートが自動作成される

### Step 2-3-4: フォームURLを取得

URLをコピーして `links` シートに追加：

```
L9001	無料相談申込みフォーム	https://docs.google.com/forms/d/e/xxxxx/viewform	LINE直接
```

✅ 無料相談フォーム完了！

---

## ⚙️ Step 2-4: フォーム送信トリガー設定（5分）

### 1. 無料鑑定フォームのトリガー

Apps Script エディタで：

1. 「トリガー」アイコン（⏰）をクリック
2. 「トリガーを追加」をクリック
3. 設定：
   ```
   実行する関数: onFreeReadingFormSubmit
   イベントのソース: スプレッドシートから
   イベントの種類: フォーム送信時
   エラー通知設定: 毎日通知を受け取る
   ```
4. 「保存」

**注意**: フォームを選択する画面が出たら、**「無料鑑定フォーム」シート**を選択

### 2. 有料鑑定フォームのトリガー

同様に設定：

```
実行する関数: onPaidReadingFormSubmit
イベントのソース: スプレッドシートから
イベントの種類: フォーム送信時
フォーム: 有料鑑定フォーム
```

### 3. 無料相談フォームのトリガー

同様に設定：

```
実行する関数: onConsultFormSubmit
イベントのソース: スプレッドシートから
イベントの種類: フォーム送信時
フォーム: 無料相談フォーム
```

### 4. 確認

「トリガー」画面に3つのトリガーが表示されることを確認：

```
✓ onFreeReadingFormSubmit - フォーム送信時
✓ onPaidReadingFormSubmit - フォーム送信時
✓ onConsultFormSubmit - フォーム送信時
```

✅ トリガー設定完了！

---

## 🔐 Step 2-5: トークン認証システムの動作確認（5分）

### トークン生成・検証の仕組み

**有料鑑定のフロー**：

```
PayPal決済完了
  ↓
GASでトークン生成（UUID）
  ↓
form_tokens シートに記録
  token: abc-123-def
  user_id: USER_001
  form_type: 有料鑑定
  used: FALSE
  ↓
メールで送信
  URL: https://forms.google.com/.../viewform?entry.xxx=abc-123-def
  ↓
ユーザーがフォーム送信
  ↓
GASでトークン検証
  - トークンが存在するか
  - used が FALSE か
  - form_type が一致するか
  ↓
OK → 記録
NG → エラー通知
  ↓
トークンを used = TRUE に更新
  ↓
2回目の送信は拒否！
```

### テスト実行

Apps Script エディタで以下を実行：

```javascript
function testTokenGeneration() {
  const token = generateFormToken_('TEST_001', '有料鑑定');
  Logger.log('生成されたトークン: ' + token);
  
  const isValid = validateFormToken_(token, '有料鑑定');
  Logger.log('トークン有効: ' + isValid);
}
```

→ ログに表示されればOK

✅ トークン認証完了！

---

## 🎯 完了チェックリスト

Googleフォーム設定が完了したか確認：

- [ ] 無料鑑定フォーム作成完了
- [ ] 有料鑑定フォーム作成完了
- [ ] 無料相談フォーム作成完了
- [ ] 3つのフォームがスプレッドシート連携済み
- [ ] フォーム送信トリガー3つ設定済み
- [ ] links シートに3つのURL登録済み
- [ ] トークン認証テスト成功

**すべて✅なら次へ！**

---

## 📌 重要な設定まとめ

### フォームURL一覧（links シート）

```
L9001: 無料相談フォーム
L9002: 無料鑑定フォーム
L9003: 有料鑑定フォーム（ベースURL）
```

### フォームフィールド対応表

| フォーム | フィールド |
|---------|----------|
| 無料鑑定 | 氏名、メール、生年月日、相談内容 |
| 有料鑑定 | トークン、氏名、メール、相談内容、詳細 |
| 無料相談 | 氏名、メール、候補日時×3、相談内容 |

---

## 🆘 トラブルシューティング

### Q: フォーム送信してもスプシに記録されない

**対処**:
1. トリガーが正しく設定されているか確認
2. Apps Script の「実行数」でエラー確認
3. フォームの回答先が正しいスプシか確認

### Q: トークンが無効と表示される

**対処**:
1. `form_tokens` シートにトークンが存在するか確認
2. `used` が FALSE になっているか確認
3. トークン文字列が完全に一致しているか確認

### Q: 同じフォームに2回回答できてしまう

**対処**:
1. `onPaidReadingFormSubmit` 関数が正しく実装されているか確認
2. トリガーが正しく設定されているか確認
3. `form_tokens` シートの `used` が TRUE に更新されているか確認

---

## ✨ 次のステップ

Googleフォーム設定が完了しました！

**→ [3_PayPal決済連携ガイド.md](./3_PayPal決済連携ガイド.md) へ進む**

次は、PayPal決済と商品ページの設定を行います！

