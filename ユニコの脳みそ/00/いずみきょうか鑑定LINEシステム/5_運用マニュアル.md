---
tags: [Guide, Operation, Manual, IzumiKyoka, 00]
date: 2026-01-20
source: ユニコの脳みそ/00
aliases: [5_運用マニュアル, Operation_Manual]
---

# [[00_知識マップ]]
# 5️⃣ 運用マニュアル

**日常運用、カスタマイズ、トラブルシューティングの完全ガイド**

システムが完成したら、このマニュアルで運用していきます。

---

## 📋 目次

1. [日常運用](#日常運用)
2. [プロンプトのカスタマイズ](#プロンプトのカスタマイズ)
3. [商品の追加・変更](#商品の追加変更)
4. [トラブルシューティング](#トラブルシューティング)
5. [コスト管理](#コスト管理)
6. [スケール時の対応](#スケール時の対応)

---

## 📅 日常運用

### 毎日のタスク（朝・10分）

#### 1. send_queue の確認

`send_queue` シートを開く：

```
status が error の行をチェック
→ error_msg を確認
→ 必要に応じて手動で対処
```

#### 2. applications の確認

`applications` シートを開く：

```
accept_reject が NG の行をチェック
→ 理由を確認
→ 必要に応じてユーザーに連絡
```

#### 3. consult_requests の確認

`consult_requests` シートを開く：

```
新しい無料相談の申込みをチェック
→ Zoom設定
→ consult_decisions に記入
→ 自動で確定通知が送信される
```

#### 4. logs の確認

`logs_[今月]` シートを開く：

```
エラーログがないか確認
→ あれば内容を確認・対処
```

**所要時間：5〜10分**

---

### 週次タスク（週1回・30分）

#### 1. KPIの集計

`kpi_daily` シートで：

```
✓ 新規登録数
✓ 申込み数（無料鑑定/有料鑑定/無料相談）
✓ 送信メール数
✓ コンバージョン率

→ Excelやスプレッドシートでグラフ化
```

#### 2. AI使用量の確認

`readings` シートで：

```
✓ 今週の鑑定件数
✓ 使用トークン数
✓ 推定コスト

→ OpenAI の Usage ページで実際のコストを確認
```

#### 3. プロンプトの見直し

`ai_prompts` シートで：

```
✓ 鑑定書のクオリティをチェック
✓ ユーザーからのフィードバックを反映
✓ 必要に応じて調整
```

#### 4. 古いデータのアーカイブ

```
✓ 30日以上前の send_queue（status=sent）を削除
✓ ログを月次アーカイブ
```

---

### 月次タスク（月1回・1時間）

#### 1. 月次レポート作成

```
✓ 総売上
✓ 決済件数
✓ 平均単価
✓ リピート率
✓ OpenAI コスト
```

#### 2. テンプレートの改善

`email_templates` シートで：

```
✓ 開封率の低いメールを特定
✓ 件名・本文を改善
✓ A/Bテスト実施
```

#### 3. バックアップ

```
1. スプレッドシート全体をコピー
2. 「占いシステム_バックアップ_2025-11」と名前を付ける
3. 専用フォルダに保存
```

---

## 🎨 プロンプトのカスタマイズ

### システムプロンプト（占い師の人格）

`ai_prompts` シートの `SYS_001` を編集：

#### 例1: もっと優しいトーンに

```
content 列を編集：

あなたは「いずみきょうか」という名前の占い師です。

【あなたの特徴】
- とても優しく、まるで親友に語りかけるような温かい文体
- 相談者の気持ちに深く寄り添い、安心感を与える
- どんな悩みも受け止め、希望を持てる言葉をかける
- 「大丈夫」「きっと良くなる」と励ます
```

#### 例2: スピリチュアル寄りに

```
【あなたの特徴】
- 宇宙や天使、スピリットガイドからのメッセージを伝える
- 前世やカルマ、魂の成長について言及する
- エネルギーの流れや波動について語る
- 神秘的で深遠な表現を使う
```

#### 例3: 厳しくも愛のある指導タイプ

```
【あなたの特徴】
- 時には厳しい言葉も辞さない、本気で相談者の成長を願う占い師
- 耳の痛いこと痛いことも正直に伝える
- でも根底には深い愛情がある
- 相談者の甘えを許さず、自立と成長を促す
```

保存するだけで、次回から新しい人格で鑑定！

---

### 商品別プロンプト（鑑定内容）

`ai_prompts` シートの商品IDごとに編集：

#### 鑑定項目を追加

PROD_001（有料鑑定・基本）の例：

```
【鑑定内容】
1. {name}様の本質・性格・才能について
2. 現在の運勢（今後3ヶ月）
3. 恋愛運について
4. 仕事運について
5. 健康運について
6. 金運について ← 追加
7. 人間関係について ← 追加
8. ご相談内容への具体的なアドバイス
9. 開運アドバイス（5つ） ← 3つ→5つに変更
10. 励ましと応援のメッセージ
```

保存するだけで、次回から新しい項目が含まれる！

---

### AI設定の調整

`ai_settings` シートで：

#### 創造性を調整

```
default_temperature を変更：

0.5 - 保守的（一貫性重視）
0.7 - バランス（推奨）
0.9 - 創造的（多様性重視）
```

#### 文字数を調整

```
default_max_tokens を変更：

1500 - 短め（コスト削減）
2000 - 標準（推奨）
3000 - 長め（詳細重視）
```

#### NGワードを追加

```
ng_words を編集：

不幸,不運,死ぬ,失敗する,病気になる,別れる,離婚
```

---

## 🛍️ 商品の追加・変更

### 新商品を追加

#### 1. products シートに追加

```
PROD_010	タロット鑑定	7000	タロットで占う	<h3>...</h3>		TRUE	鑑定	10	
```

#### 2. ai_prompts シートにプロンプト追加

```
PROD_010	product	PROD_010	タロット鑑定の構成	【鑑定内容】\n1. タロットカードから見るあなたの運命\n2. ...	TRUE	10	
```

これだけ！即座に商品ページに表示される！

---

### 既存商品を変更

#### 価格変更

`products` シートの `price` 列を編集：

```
PROD_001: 5000 → 6000
```

保存するだけで即座に反映！

#### 商品を非表示

`products` シートの `active` 列を編集：

```
PROD_004: TRUE → FALSE
```

保存するだけで商品ページから消える！

#### 説明文を変更

`products` シートの `description` または `detail_html` を編集：

```
description: 30分の詳細鑑定 → 40分の徹底鑑定
```

保存するだけで反映！

---

## 🆘 トラブルシューティング

### メールが送信されない

#### 確認項目

1. `config` シート：
   - `freeze_all` = FALSE か？
   - `freeze_sending` = FALSE か？

2. `send_queue` シート：
   - `status` = pending の行があるか？
   - `scheduled_at` が過去の日時か？
   - `error_msg` に何か書かれていないか？

3. トリガー：
   - Apps Script の「トリガー」で `tick` が設定されているか？

#### 対処法

```
freeze が TRUE の場合:
→ FALSE に変更

error_msg がある場合:
→ 内容を確認して対処

トリガーがない場合:
→ setupTriggers() を再実行
```

---

### AI鑑定が生成されない

#### 確認項目

1. `ai_reading_schedule` シート：
   - 該当のスケジュールがあるか？
   - `status` = pending か？
   - `scheduled_at` が過去か？

2. `config` シート：
   - `openai_api_key` が正しいか？

3. OpenAI：
   - 課金設定がされているか？
   - Usage limit に達していないか？

#### 対処法

```
scheduled_at が未来の場合:
→ 時刻を現在に変更

openai_api_key が無効の場合:
→ OpenAI Platform で新しいキーを発行

usage limit の場合:
→ OpenAI の Billing で上限を上げる
```

---

### フォームが2回以上回答できる

#### 確認項目

1. トリガー：
   - `onPaidReadingFormSubmit` が設定されているか？

2. `form_tokens` シート：
   - トークンの `used` が TRUE に更新されているか？

3. Code.gs：
   - `validateFormToken_()` 関数が正しく実装されているか？

#### 対処法

```
トリガーがない場合:
→ 手動で設定

used が FALSE のままの場合:
→ onPaidReadingFormSubmit の実装を確認
```

---

### 決済後、フォームURLが届かない

#### 確認項目

1. `payments` シート：
   - 決済記録があるか？

2. `form_tokens` シート：
   - トークンが生成されているか？

3. `send_queue` シート：
   - メールキューが追加されているか？

4. Code.gs：
   - `handlePayPalPayment_()` が正しく実装されているか？
   - `generatePaidFormURL_()` の entry ID が正しいか？

#### 対処法

```
payments に記録がない場合:
→ PayPal Webhook の設定を確認

form_tokens に記録がない場合:
→ handlePayPalPayment_ の実装を確認

entry ID が間違っている場合:
→ フォームのプレフィルURLから正しいIDを取得
```

---

## 💰 コスト管理

### OpenAI 使用量の確認

#### 月次レポート

Apps Script エディタで実行：

```javascript
function getMonthlyAIUsage() {
  const usage = getMonthlyAIUsage(2025, 11);
  Logger.log('鑑定件数: ' + usage.count);
  Logger.log('トークン数: ' + usage.totalTokens);
  Logger.log('推定コスト: $' + usage.estimatedCostUSD.toFixed(2));
  Logger.log('推定コスト: ¥' + Math.round(usage.estimatedCostJPY));
}
```

#### OpenAI Platform で確認

1. [OpenAI Platform](https://platform.openai.com/) にログイン
2. 「Usage」をクリック
3. 実際の使用量とコストを確認

### コスト削減のヒント

#### 1. モデルを変更

```
config シート:
openai_model: gpt-4o → gpt-4o-mini

→ コストが1/10に！
```

#### 2. トークン数を削減

```
ai_settings シート:
default_max_tokens: 2000 → 1500

→ コストが25%削減！
```

#### 3. 無料鑑定は短めに

商品別にmax_tokensを変える（Code.gs修正が必要）：

```javascript
if (applicationType === '無料鑑定') {
  maxTokens = 1000;
} else {
  maxTokens = 2000;
}
```

---

## 📈 スケール時の対応

### 月100件 → 月1,000件にスケールする場合

#### 1. Gmail送信制限対策

**問題**: Gmailは1日500通まで

**対策1**: Google Workspace に移行
```
費用: 680円/月
送信上限: 2,000通/日
```

**対策2**: SendGrid等の外部サービス
```
費用: 月3,000円〜
送信上限: 無制限
```

詳細は `LINE連携ガイド.md` の「SendGrid連携」を参照。

#### 2. OpenAI コスト対策

**月1,000件の場合**:
```
GPT-4o-mini: 約¥300/月
GPT-4o: 約¥3,000/月

→ GPT-4o-miniで十分！
```

#### 3. スプレッドシート容量対策

**問題**: 行数制限（500万行）

**対策**: 月次アーカイブ
```
1. 毎月1日に前月データをエクスポート
2. 別スプレッドシートに保存
3. 元のシートから削除
```

#### 4. 実行時間対策

**問題**: GASは6分/回の制限

**対策**: 処理を分散
```
// Code.gs の processSendQueue_ で

let processedCount = 0;
const maxPerTick = 5; // 1回につき5件まで

for (...) {
  if (processedCount >= maxPerTick) break;
  // 処理
  processedCount++;
}
```

---

## 📊 本番運用前の最終チェック

### 設定確認

`config` シートで：

```
☑ preview_mode: FALSE に変更（本番開始時）
☑ freeze_sending: FALSE
☑ freeze_all: FALSE
☑ openai_api_key: 正しく設定されている
☑ paypal_client_id: 本番用（Sandboxではない）
☑ sender_email: 占い師用Gmail
☑ ops_email: 運営メール
```

### データ確認

```
☑ products: 商品情報が正しい
☑ ai_prompts: プロンプトが完成している
☑ email_templates: メール文面が完成している
☑ links: すべてのURLが正しい
```

### テスト確認

```
☑ 無料鑑定フォーム → AI鑑定 → メール送信（成功）
☑ 有料鑑定決済 → フォームURL送信 → 1回限り回答（成功）
☑ 無料相談フォーム → 運営通知 → 確定通知（成功）
☑ LINEリッチメニュー → 各ページへの遷移（成功）
```

すべて✅なら、本番稼働OK！

---

## 🎉 おめでとうございます！

完全自動化占いシステムが完成しました！

### システムの強み

```
✅ 申込み → 決済 → 鑑定 → 送信 すべて自動
✅ スプシで全管理、コード編集不要
✅ 1鑑定0.3円〜の低コスト
✅ 月1,000件でもスケール可能
✅ LINE × PayPal × OpenAI の完全統合
```

### 次のアクション

1. **preview_mode を FALSE に**して本番開始
2. **LINE で告知**して集客開始
3. **毎日10分**のチェックで運用
4. **月次で改善**していく

**完全自動で占いビジネスが回ります！** 🚀✨

---

## 📞 サポート

質問があれば **FAQ.md** を確認してください。

システムの改善提案も歓迎します！

**あなたのビジネスの成功を心よりお祈りしています！** 🌟

