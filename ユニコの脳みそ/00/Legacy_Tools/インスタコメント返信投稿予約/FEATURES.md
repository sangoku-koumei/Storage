#ToolDev #InstagramAutomation #FeatureGuide

# 機能詳細説明書

## 📋 目次

1. [予約投稿機能](#1-予約投稿機能)
2. [コメント自動返信機能](#2-コメント自動返信機能)
3. [DM自動返信機能](#3-dm自動返信機能)
4. [テンプレート管理機能](#4-テンプレート管理機能)
5. [インボックス機能](#5-インボックス機能)
6. [ルール管理機能](#6-ルール管理機能)
7. [カレンダー機能](#7-カレンダー機能)
8. [ログ・デバッグ機能](#8-ログデバッグ機能)
9. [Google Sheets連携機能](#9-google-sheets連携機能)

---

## 1. 予約投稿機能

### 概要

Instagramへの投稿を事前に予約し、指定した日時に自動投稿する機能です。Feed投稿、Reel投稿、Story投稿の3種類に対応しています。

### 詳細機能

#### 1.1 投稿タイプ

| 投稿タイプ | 説明 | 対応メディア |
|-----------|------|------------|
| **Feed** | 通常の投稿（タイムラインに表示） | 画像・動画 |
| **Reel** | リール動画（リールタブに表示） | 動画のみ |
| **Story** | ストーリーズ（24時間表示） | 画像・動画 |

#### 1.2 メディアタイプ

| メディアタイプ | 説明 | 対応投稿タイプ |
|--------------|------|--------------|
| **image** | 画像ファイル | Feed, Story |
| **video** | 動画ファイル | Feed, Reel, Story |

#### 1.3 投稿状態

| 状態 | 説明 | 操作 |
|-----|------|------|
| **pending** | 予約済み（未投稿） | 編集・削除・一時停止可能 |
| **processing** | 投稿処理中 | 操作不可 |
| **posted** | 投稿完了 | 削除のみ可能 |
| **failed** | 投稿失敗 | 再試行・削除可能 |
| **canceled** | キャンセル済み | 削除のみ可能 |
| **paused** | 一時停止中 | 再開・削除可能 |

#### 1.4 スケジュール管理

- **日時指定**: 年・月・日・時・分を指定して投稿を予約
- **カレンダー表示**: 月次カレンダーで投稿予定を視覚化
- **ドラッグ&ドロップ**: カレンダー上で投稿をドラッグして日時を変更
- **一括操作**: 複数の投稿を選択して一括編集・削除（将来実装）

#### 1.5 キャプション管理

- **テキスト入力**: 投稿ごとにキャプションを設定
- **テンプレート連携**: キャプション用テンプレートを使用可能
- **ハッシュタグ**: ハッシュタグを含めることが可能
- **改行対応**: 複数行のキャプションに対応

#### 1.6 メディア管理

- **URL指定**: 画像・動画のURLを指定
- **バリデーション**: 投稿タイプとメディアタイプの組み合わせを検証
- **エラーハンドリング**: 無効なURLやアクセス不可のメディアを検出

### 使用フロー

```
1. 投稿作成画面を開く
2. アカウントを選択
3. 投稿タイプを選択（Feed/Reel/Story）
4. メディアタイプを選択（image/video）
5. メディアURLを入力
6. キャプションを入力（またはテンプレートを選択）
7. 投稿日時を指定
8. 予約投稿を作成
9. カレンダーで確認
10. 指定した日時に自動投稿
```

### APIエンドポイント

- `POST /posts`: 予約投稿を作成
- `GET /posts`: 予約投稿一覧を取得
- `GET /posts/{id}`: 予約投稿の詳細を取得
- `PUT /posts/{id}`: 予約投稿を更新
- `DELETE /posts/{id}`: 予約投稿を削除
- `POST /posts/{id}/pause`: 予約投稿を一時停止
- `POST /posts/{id}/resume`: 予約投稿を再開
- `GET /calendar/posts`: カレンダー用の投稿一覧を取得
- `PUT /posts/{id}/reschedule`: 予約投稿の日時を変更

---

## 2. コメント自動返信機能

### 概要

Instagramのコメントに対して、キーワードベースで自動返信を行う機能です。複数のルールを設定でき、優先度に基づいて最適なルールを適用します。

### 詳細機能

#### 2.1 ルール設定

- **キーワード**: コメント内容に含まれるキーワードを指定（部分一致）
- **返信テキスト**: 自動返信するテキストを設定
- **テンプレート連携**: 事前に作成したテンプレートを使用可能
- **優先度**: 数字で設定（数字が小さいほど優先度が高い）
- **有効/無効**: ルールを一時的に無効化可能

#### 2.2 マッチングロジック

1. コメントが投稿される
2. 有効なルールを優先度順にチェック
3. コメント内容にキーワードが含まれているか確認
4. 最初にマッチしたルールを適用
5. 返信テキスト（またはテンプレート）で自動返信

#### 2.3 優先度システム

- **優先度1**: 最も優先度が高い（最初にチェック）
- **優先度2**: 次に優先度が高い
- **優先度3以降**: 順次チェック

複数のルールがマッチする場合、優先度の高いルールが適用されます。

#### 2.4 ルールテスト機能

- **テスト入力**: テキストを入力してマッチングをテスト
- **マッチ結果**: どのルールがマッチするか表示
- **返信プレビュー**: 返信テキストをプレビュー

#### 2.5 返信履歴

- **すべての返信を記録**: 自動返信の履歴を保存
- **コメント内容**: 元のコメント内容を保存
- **使用ルール**: どのルールが使用されたかを記録
- **返信時刻**: 返信した時刻を記録

### 使用フロー

```
1. コメント自動返信ルールを作成
2. キーワードを設定（例: "ありがとう"）
3. 返信テキストを設定（例: "どういたしまして！"）
4. 優先度を設定（例: 1）
5. テンプレートを選択（オプション）
6. ルールを有効化
7. ルールテストで動作確認
8. コメントが来ると自動返信
9. インボックスで返信履歴を確認
```

### APIエンドポイント

- `POST /comment-rules`: コメント自動返信ルールを作成
- `GET /comment-rules`: コメント自動返信ルール一覧を取得
- `GET /comment-rules/{id}`: コメント自動返信ルールの詳細を取得
- `PUT /comment-rules/{id}`: コメント自動返信ルールを更新
- `DELETE /comment-rules/{id}`: コメント自動返信ルールを削除
- `POST /comment-rules/reorder`: コメント自動返信ルールの優先度を変更
- `POST /comment-rules/test`: コメント自動返信ルールをテスト

---

## 3. DM自動返信機能

### 概要

Instagramのダイレクトメッセージ（DM）に対して、キーワードベースで自動返信を行う機能です。Metaの24時間ルールを厳密に遵守し、安全に自動返信を行います。

### 詳細機能

#### 3.1 ルール設定

- **キーワード**: DM内容に含まれるキーワードを指定（部分一致）
- **返信テキスト**: 自動返信するテキストを設定
- **テンプレート連携**: 事前に作成したテンプレートを使用可能
- **優先度**: 数字で設定（数字が小さいほど優先度が高い）
- **有効/無効**: ルールを一時的に無効化可能

#### 3.2 24時間ルール

Metaのポリシーにより、ユーザーからの最後のメッセージから**24時間以内**のみ自動返信が可能です。

- **会話状態管理**: ユーザーごとの会話履歴を管理
- **最後のメッセージ時刻**: ユーザーからの最後のメッセージ時刻を記録
- **自動判定**: 24時間以内かどうかを自動判定
- **安全な実装**: 24時間を過ぎた場合は自動返信を行わない

#### 3.3 マッチングロジック

1. DMが受信される
2. ユーザーの会話状態を確認
3. 24時間以内かどうかを判定
4. 24時間以内の場合、有効なルールを優先度順にチェック
5. DM内容にキーワードが含まれているか確認
6. 最初にマッチしたルールを適用
7. 返信テキスト（またはテンプレート）で自動返信
8. 会話状態を更新

#### 3.4 優先度システム

コメント自動返信と同じ優先度システムを使用します。

#### 3.5 ルールテスト機能

- **テスト入力**: テキストを入力してマッチングをテスト
- **マッチ結果**: どのルールがマッチするか表示
- **返信プレビュー**: 返信テキストをプレビュー
- **24時間ルール状態**: テスト時は24時間ルールを無視（実際の返信時は適用）

#### 3.6 返信履歴

- **すべての返信を記録**: 自動返信の履歴を保存
- **DM内容**: 元のDM内容を保存
- **使用ルール**: どのルールが使用されたかを記録
- **返信時刻**: 返信した時刻を記録
- **24時間ルール状態**: 自動返信可能だったかどうかを記録

### 使用フロー

```
1. DM自動返信ルールを作成
2. キーワードを設定（例: "こんにちは"）
3. 返信テキストを設定（例: "こんにちは！"）
4. 優先度を設定（例: 1）
5. テンプレートを選択（オプション）
6. ルールを有効化
7. ルールテストで動作確認
8. DMが来ると、24時間以内であれば自動返信
9. インボックスで返信履歴を確認
```

### APIエンドポイント

- `POST /dm-rules`: DM自動返信ルールを作成
- `GET /dm-rules`: DM自動返信ルール一覧を取得
- `GET /dm-rules/{id}`: DM自動返信ルールの詳細を取得
- `PUT /dm-rules/{id}`: DM自動返信ルールを更新
- `DELETE /dm-rules/{id}`: DM自動返信ルールを削除
- `POST /dm-rules/reorder`: DM自動返信ルールの優先度を変更
- `POST /dm-rules/test`: DM自動返信ルールをテスト

---

## 4. テンプレート管理機能

### 概要

よく使うメッセージをテンプレートとして保存し、ルールや投稿で再利用できる機能です。

### 詳細機能

#### 4.1 テンプレートの種類

| 種類 | 説明 | 使用場所 |
|-----|------|---------|
| **comment** | コメント用テンプレート | コメント自動返信ルール |
| **dm** | DM用テンプレート | DM自動返信ルール |
| **caption** | キャプション用テンプレート | 予約投稿のキャプション |

#### 4.2 テンプレートの作成

- **テンプレート名**: テンプレートを識別する名前
- **本文**: テンプレートの内容
- **種別**: comment/dm/captionのいずれかを選択
- **有効/無効**: テンプレートを一時的に無効化可能

#### 4.3 テンプレートの使用

- **ルールでの使用**: 自動返信ルールでテンプレートを選択
- **投稿での使用**: 予約投稿のキャプションでテンプレートを選択
- **動的置換**: 将来的に変数を置換する機能を追加（将来実装）

#### 4.4 テンプレート管理

- **一覧表示**: すべてのテンプレートを一覧表示
- **種別フィルタ**: コメント/DM/キャプションでフィルタ
- **編集**: 既存のテンプレートを編集
- **削除**: 不要なテンプレートを削除

### 使用フロー

```
1. テンプレート管理画面を開く
2. 新しいテンプレートを作成
3. テンプレート名を入力（例: "お問い合わせありがとう"）
4. 本文を入力（例: "お問い合わせありがとうございます。詳細はDMでお願いします。"）
5. 種別を選択（comment/dm/caption）
6. テンプレートを保存
7. ルールや投稿でテンプレートを選択
```

### APIエンドポイント

- `POST /templates`: テンプレートを作成
- `GET /templates`: テンプレート一覧を取得
- `GET /templates/{id}`: テンプレートの詳細を取得
- `PUT /templates/{id}`: テンプレートを更新
- `DELETE /templates/{id}`: テンプレートを削除

---

## 5. インボックス機能

### 概要

コメントとDMを一元管理し、未返信・返信済みを確認できる機能です。

### 詳細機能

#### 5.1 コメントインボックス

- **コメント一覧**: すべてのコメントを一覧表示
- **フィルタ機能**: 未返信・返信済みでフィルタ
- **コメント詳細**: コメント内容、送信者、時刻を表示
- **投稿情報**: どの投稿へのコメントかを表示
- **返信情報**: 自動返信の有無、使用ルールを表示
- **ステータス管理**: 未処理・処理済みのステータスを更新
- **手動返信**: 自動返信されなかったコメントに手動で返信

#### 5.2 DMインボックス

- **DM一覧**: すべてのDMを一覧表示
- **フィルタ機能**: 未返信・返信済みでフィルタ
- **会話履歴**: ユーザーごとの会話履歴を表示
- **24時間ルール状態**: 自動返信可能/不可能を表示
- **返信情報**: 自動返信の有無、使用ルールを表示
- **ステータス管理**: 未処理・処理済みのステータスを更新
- **手動返信**: 自動返信されなかったDMに手動で返信

#### 5.3 ステータス管理

| ステータス | 説明 | 操作 |
|-----------|------|------|
| **unhandled** | 未処理 | 手動返信・ステータス更新可能 |
| **done** | 処理済み | ステータス更新のみ可能 |

### 使用フロー

```
1. インボックス画面を開く
2. コメント/DMタブを選択
3. 未返信のコメント/DMを確認
4. コメント/DMをクリックして詳細を表示
5. 必要に応じて手動で返信
6. 処理済みとしてマーク
```

### APIエンドポイント

- `GET /inbox/comments`: コメントインボックス一覧を取得
- `PUT /inbox/comments/{id}/status`: コメントのステータスを更新
- `GET /inbox/dms`: DMインボックス一覧を取得
- `PUT /inbox/dms/{id}/status`: DMのステータスを更新

---

## 6. ルール管理機能

### 概要

コメント・DM自動返信のルールを管理し、優先度を調整できる機能です。

### 詳細機能

#### 6.1 ルール一覧

- **優先度順表示**: ルールを優先度順に表示
- **有効/無効表示**: ルールの有効/無効状態を表示
- **キーワード表示**: ルールのキーワードを表示
- **返信テキスト表示**: ルールの返信テキストを表示
- **テンプレート表示**: 使用しているテンプレートを表示

#### 6.2 優先度変更

- **ドラッグ&ドロップ**: ルールをドラッグ&ドロップで優先度を変更
- **自動保存**: 優先度変更後、自動的に保存
- **即座に反映**: 優先度変更後、即座に反映

#### 6.3 ルールテスト

- **テスト入力**: テキストを入力してマッチングをテスト
- **マッチ結果**: どのルールがマッチするか表示
- **返信プレビュー**: 返信テキストをプレビュー
- **複数マッチ**: 複数のルールがマッチする場合、優先度の高いルールを表示

#### 6.4 ルール編集

- **キーワード編集**: ルールのキーワードを編集
- **返信テキスト編集**: ルールの返信テキストを編集
- **テンプレート変更**: 使用するテンプレートを変更
- **優先度変更**: ルールの優先度を変更
- **有効/無効切り替え**: ルールを有効/無効に切り替え

### 使用フロー

```
1. ルール管理画面を開く
2. コメント/DMタブを選択
3. ルール一覧を確認
4. 新しいルールを作成
5. ルールテストで動作確認
6. ドラッグ&ドロップで優先度を調整
7. 必要に応じてルールを編集・削除
```

### APIエンドポイント

- `POST /comment-rules/reorder`: コメント自動返信ルールの優先度を変更
- `POST /comment-rules/test`: コメント自動返信ルールをテスト
- `POST /dm-rules/reorder`: DM自動返信ルールの優先度を変更
- `POST /dm-rules/test`: DM自動返信ルールをテスト

---

## 7. カレンダー機能

### 概要

投稿予定を月次カレンダーで視覚的に確認・管理できる機能です。

### 詳細機能

#### 7.1 カレンダー表示

- **月次カレンダー**: 月次カレンダーで投稿予定を表示
- **日次表示**: 日次表示で投稿予定を表示（将来実装）
- **週次表示**: 週次表示で投稿予定を表示（将来実装）

#### 7.2 状態別色分け

| 状態 | 色 | 説明 |
|-----|----|----|
| **pending** | 青 | 予約済み（未投稿） |
| **processing** | 黄 | 投稿処理中 |
| **posted** | 緑 | 投稿完了 |
| **failed** | 赤 | 投稿失敗 |
| **canceled** | 灰 | キャンセル済み |
| **paused** | 橙 | 一時停止中 |

#### 7.3 スケジュール変更

- **ドラッグ&ドロップ**: カレンダー上で投稿をドラッグして日時を変更
- **クリック編集**: 投稿をクリックして日時を編集
- **一括変更**: 複数の投稿を選択して一括変更（将来実装）

#### 7.4 フィルタ機能

- **アカウントフィルタ**: 特定のアカウントの投稿のみ表示
- **投稿タイプフィルタ**: Feed/Reel/Storyでフィルタ
- **状態フィルタ**: 特定の状態の投稿のみ表示

#### 7.5 投稿詳細

- **投稿情報**: 投稿タイプ、メディアタイプ、キャプションを表示
- **スケジュール情報**: 予約日時、投稿状態を表示
- **編集**: 投稿を編集
- **削除**: 投稿を削除

### 使用フロー

```
1. カレンダー画面を開く
2. 月次カレンダーで投稿予定を確認
3. フィルタで表示を絞り込み
4. 投稿をドラッグ&ドロップで日時を変更
5. 投稿をクリックして詳細を確認
6. 必要に応じて編集・削除
```

### APIエンドポイント

- `GET /calendar/posts`: カレンダー用の投稿一覧を取得
- `PUT /posts/{id}/reschedule`: 予約投稿の日時を変更

---

## 8. ログ・デバッグ機能

### 概要

アプリケーションの動作を記録し、問題の特定やデバッグを支援する機能です。

### 詳細機能

#### 8.1 イベントログ

- **すべてのイベントを記録**: システムイベントをすべて記録
- **イベントタイプ**: イベントの種類を分類
- **ソース**: イベントの発生源を記録
- **メッセージ**: イベントの説明を記録
- **メタデータ**: イベントの詳細情報をJSON形式で記録

#### 8.2 ログレベル

| レベル | 説明 | 使用例 |
|------|------|--------|
| **ERROR** | エラーが発生した場合 | API呼び出し失敗、データベースエラー |
| **WARN** | 警告（注意が必要な場合） | レート制限接近、異常な値 |
| **INFO** | 通常の情報 | 投稿成功、返信成功 |
| **DEBUG** | デバッグ情報 | 詳細なリクエストログ |

#### 8.3 ログフィルタ

- **レベルフィルタ**: ERROR/WARN/INFO/DEBUGでフィルタ
- **ソースフィルタ**: イベントの発生源でフィルタ
- **期間フィルタ**: 期間を指定してフィルタ
- **キーワード検索**: メッセージでキーワード検索（将来実装）

#### 8.4 ログファイル

- **ローテーション**: ファイルサイズや日付でローテーション
- **複数ファイル**: レベル別にファイルを分離（将来実装）
- **圧縮**: 古いログファイルを圧縮（将来実装）

#### 8.5 デバッグモード

- **詳細ログ**: 開発時のみ詳細なリクエストログを出力
- **リクエスト/レスポンス**: APIリクエストとレスポンスを記録
- **パフォーマンス**: 処理時間を記録（将来実装）

### 使用フロー

```
1. ログ画面を開く
2. 期間やレベルでフィルタ
3. エラーや警告を確認
4. 詳細情報を展開して原因を特定
5. 必要に応じてログファイルを確認
```

### APIエンドポイント

- `GET /logs`: アプリケーションイベントログ一覧を取得

---

## 9. Google Sheets連携機能

### 概要

アプリケーションのログをGoogleスプレッドシートにエクスポートし、レポートや分析に活用できる機能です。

### 詳細機能

#### 9.1 ログエクスポート

- **イベントログのエクスポート**: アプリケーションイベントログをスプレッドシートに出力
- **自動更新**: 定期的にスプレッドシートを更新（将来実装）
- **カスタムフォーマット**: レポート用にカスタムフォーマットで出力（将来実装）

#### 9.2 レポート作成

- **日次レポート**: 1日の投稿数、返信数を集計（将来実装）
- **週次レポート**: 1週間の投稿数、返信数を集計（将来実装）
- **月次レポート**: 1ヶ月の投稿数、返信数を集計（将来実装）

#### 9.3 データ分析

- **投稿分析**: 投稿の種類、時間帯、エンゲージメントを分析（将来実装）
- **返信分析**: 返信の種類、時間帯、効果を分析（将来実装）
- **トレンド分析**: 長期的なトレンドを分析（将来実装）

### 使用フロー

```
1. Google Cloud Consoleでサービスアカウントを作成
2. サービスアカウントのJSONキーをダウンロード
3. スプレッドシートにサービスアカウントを共有
4. 設定を完了
5. ログが自動的にスプレッドシートに出力
6. スプレッドシートでレポートや分析を実施
```

### APIエンドポイント

- `POST /sheets/export`: ログをスプレッドシートにエクスポート（将来実装）

---

## 📊 機能一覧表

| 機能 | ステータス | 優先度 |
|-----|----------|--------|
| 予約投稿（Feed） | ✅ 実装済み | 高 |
| 予約投稿（Reel） | ✅ 実装済み | 高 |
| 予約投稿（Story） | ✅ 実装済み | 高 |
| コメント自動返信 | ✅ 実装済み | 高 |
| DM自動返信 | ✅ 実装済み | 高 |
| テンプレート管理 | ✅ 実装済み | 中 |
| インボックス | ✅ 実装済み | 高 |
| ルール管理 | ✅ 実装済み | 中 |
| カレンダー | ✅ 実装済み | 高 |
| ログ・デバッグ | ✅ 実装済み | 中 |
| Google Sheets連携 | ✅ 実装済み | 低 |

---

**最終更新**: 2024年
**バージョン**: 1.0.0

---

## 関連リンク
- [[TOOL_DESCRIPTION]]
- [[PROJECT_DESIGN]]
- [[2025-12-15-ツール作成アイデア]]
- [[2025-12-22-インスタ動画解析結果]]
- [[2026-01-13_ツール開発・改善知見バイブル_深層対話]]
- [[00 Rules]]

