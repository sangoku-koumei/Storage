
---
tags: [GAS, n8n, Integration, Automation, Legacy_Knowledge]
date: 2026-01-09
source: Legacy_File_Optimization
aliases: [GAS_n8n_Integration, GAS_n8né€£æºç‰ˆ]
---

# [[2026-01-09_GAS_n8né€£æºç‰ˆ]]
# n8né€£æºç”¨ GASã‚³ãƒ¼ãƒ‰ (è»½é‡åŒ–ãƒ»æ”¹å–„ç‰ˆ)

Backlink: [[2026-01-09_ä½œæ¥­ãƒ¡ãƒ¢]] [[2026-01-09_n8n_ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼è¨­è¨ˆæ›¸]]

## Keywords & Tags
#GAS #n8n #Integration #Automation #Legacy_Knowledge

---

n8nå°å…¥ã«ä¼´ã„ã€GASå´ã®å½¹å‰²ã‚’ã€Œé‡ãŸã„å‡¦ç†ã®å®Ÿè¡Œã€ã‹ã‚‰**ã€Œn8nã¸ã®æŒ‡ç¤ºå‡ºã—ï¼ˆå¸ä»¤å¡”ï¼‰ã€**ã¸ã‚·ãƒ•ãƒˆã—ã¾ã™ã€‚
ã“ã‚Œã«ã‚ˆã‚Šã€GASç‰¹æœ‰ã®ã€Œ6åˆ†ã®å£ï¼ˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼‰ã€ã‚„ã€Œãƒ¡ãƒ¢ãƒªä¸è¶³ã€ã‹ã‚‰å®Œå…¨ã«è§£æ”¾ã•ã‚Œã¾ã™ã€‚

æ—¢å­˜ã® `SNSè‡ªå‹•åŒ–_GASç‰ˆ.js` ã®å†…å®¹ã‚’ã€ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã§ç½®ãæ›ãˆï¼ˆã¾ãŸã¯è¿½è¨˜ï¼‰ã—ã¦ãã ã•ã„ã€‚

---

## âš™ï¸ å…±é€šè¨­å®š: n8nã¨ã®æ¥ç¶š

n8nã®Webhook URLã‚’å®šæ•°ã¨ã—ã¦ç®¡ç†ã—ã¾ã™ã€‚
â€»URLã¯n8nã§ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ä½œæˆã—ãŸå¾Œã«ç™ºè¡Œã•ã‚Œã‚‹ã‚‚ã®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚

```javascript
// n8nã®Webhook URLè¨­å®š (ã”è‡ªèº«ã®n8nç’°å¢ƒã«åˆã‚ã›ã¦æ›¸ãæ›ãˆã¦ãã ã•ã„)
const N8N_URLS = {
  RESEARCH: "https://<YOUR-VPS-IP>:5678/webhook/research",
  IMAGE_GEN: "https://<YOUR-VPS-IP>:5678/webhook/generate-image",
  AUTO_POST: "https://<YOUR-VPS-IP>:5678/webhook/trigger-post"
};

/**
 * n8nã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã™ã‚‹å…±é€šé–¢æ•°
 */
function triggerN8n(url, payload) {
  const options = {
    "method": "post",
    "contentType": "application/json",
    "payload": JSON.stringify(payload),
    "muteHttpExceptions": true
  };
  
  try {
    const response = UrlFetchApp.fetch(url, options);
    Logger.log(response.getContentText());
    return true;
  } catch (e) {
    Browser.msgBox("ã‚¨ãƒ©ãƒ¼: n8nã¸ã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ\\n" + e.message);
    return false;
  }
}
```

---

## 1. ğŸ” ç«¶åˆãƒªã‚µãƒ¼ãƒ (n8nå§”è­²ç‰ˆ)

GASã¯ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’é€ã‚‹ã ã‘ã€‚é‡ãŸã„Webæ¤œç´¢ã‚„åˆ†æã¯n8nï¼ˆLangChainï¼‰ãŒè£ã§å®Ÿè¡Œã—ã€çµ‚ã‚ã£ãŸã‚‰ã‚·ãƒ¼ãƒˆã«æ›¸ãè¾¼ã¿ã«æ¥ã¦ãã‚Œã¾ã™ã€‚

```javascript
function runResearchN8n() {
  const ui = SpreadsheetApp.getUi();
  const keyword = ui.prompt('ç«¶åˆãƒªã‚µãƒ¼ãƒ(n8n)', 'ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›:', ui.ButtonSet.OK_CANCEL).getResponseText();
  
  if (!keyword) return;

  // n8nã«æŒ‡ç¤ºã‚’é£›ã°ã™
  const success = triggerN8n(N8N_URLS.RESEARCH, {
    keyword: keyword,
    sheetId: SpreadsheetApp.getActiveSpreadsheet().getId()
  });

  if (success) {
    ui.alert('ãƒªã‚µãƒ¼ãƒæŒ‡ä»¤ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚', 'n8nãŒãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§åˆ†æã‚’å®Ÿè¡Œä¸­ã§ã™ã€‚\nå®Œäº†ã™ã‚‹ã¨[Research]ã‚·ãƒ¼ãƒˆã«è‡ªå‹•ã§è¿½è¨˜ã•ã‚Œã¾ã™ã€‚', ui.ButtonSet.OK);
  }
}
```

---

## 2. ğŸ¨ DALL-E 3 ç”»åƒç”Ÿæˆ (n8nå§”è­²ç‰ˆ)

ã‚·ãƒ¼ãƒˆä¸Šã®ãƒ‡ãƒ¼ã‚¿ã‚’ã¾ã¨ã‚ã¦n8nã«é€ã‚Šã¾ã™ã€‚GASã¯å¾…ã¤å¿…è¦ãŒãªãã€ã™ãã«çµ‚äº†ã—ã¾ã™ã€‚

```javascript
function generateImagesN8n() {
  const sheet = SpreadsheetApp.getActiveSheet();
  const rows = sheet.getDataRange().getValues();
  const ui = SpreadsheetApp.getUi();
  
  // æœªç”Ÿæˆã®è¡Œï¼ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚ã‚Šã€URLãªã—ï¼‰ã‚’æ¢ã™
  let count = 0;
  
  for (let i = 1; i < rows.length; i++) {
    const prompt = rows[i][4]; // Eåˆ—: Image Prompt
    const existingUrl = rows[i][5]; // Fåˆ—: Image URL
    
    if (prompt && !existingUrl) {
      // 1è¡Œãšã¤n8nã«ã€Œä½œã£ã¦ï¼ã€ã¨æŠ•ã’ã‚‹
      triggerN8n(N8N_URLS.IMAGE_GEN, {
        prompt: prompt,
        row_index: i + 1, // è¡Œç•ªå· (n8nãŒæ›¸ãæˆ»ã™ã¨ãã«ä½¿ã†)
        sheetId: SpreadsheetApp.getActiveSpreadsheet().getId()
      });
      count++;
    }
  }

  if (count > 0) {
    ui.alert('ç”»åƒç”Ÿæˆã‚’é–‹å§‹ã—ã¾ã—ãŸ', `${count}ä»¶ã®ç”Ÿæˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’n8nã«é€ä¿¡ã—ã¾ã—ãŸã€‚\né †æ¬¡ãƒ‰ãƒ©ã‚¤ãƒ–ã«ä¿å­˜ã•ã‚Œã€URLãŒè¨˜å…¥ã•ã‚Œã¾ã™ã€‚`, ui.ButtonSet.OK);
  } else {
    ui.alert('ç”Ÿæˆå¯¾è±¡ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚', 'ã€ŒImage Promptã€ãŒã‚ã‚Šã€ŒImage URLã€ãŒç©ºã®è¡Œã®ã¿å¯¾è±¡ã§ã™ã€‚', ui.ButtonSet.OK);
  }
}
```

---

## 3. ğŸš€ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®æ›´æ–°

`onOpen`é–¢æ•°ã‚’æ›´æ–°ã—ã¦ã€æ–°ã—ã„ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```javascript
function onOpen() {
  SpreadsheetApp.getUi()
    .createMenu('ğŸ’ SNSè‡ªå‹•åŒ–(n8n)')
    .addItem('1. ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ä¼ç”»', 'createCampaign') // æ—¢å­˜ã®GASé–¢æ•°(ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆã¯GASã§ã‚‚OK)
    .addItem('2. ç«¶åˆãƒªã‚µãƒ¼ãƒ (n8n)', 'runResearchN8n')
    .addItem('3. ç”»åƒç”Ÿæˆ (n8n)', 'generateImagesN8n')
    .addSeparator()
    .addItem('ğŸ”§ n8næ¥ç¶šãƒ†ã‚¹ãƒˆ', 'testConnection')
    .addToUi();
}

function testConnection() {
  // ç–é€šç¢ºèªç”¨
  triggerN8n(N8N_URLS.AUTO_POST, {test: "hello"});
}
```

---

## ğŸ“ ç§»è¡Œã®ãƒã‚¤ãƒ³ãƒˆ

1.  **å¤ã„ã‚³ãƒ¼ãƒ‰ã¯æ®‹ã—ã¦ã‚‚OK**: å¿µã®ãŸã‚ã€å¤ã„ `generateDalleImages` ãªã©ã¯é–¢æ•°åã‚’å¤‰ãˆã‚‹ï¼ˆ`_old`ã‚’ã¤ã‘ã‚‹ãªã©ï¼‰ã‹ã€ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã—ã¦æ®‹ã—ã¦ãŠãã¨å®‰å¿ƒã§ã™ã€‚
2.  **Webhook URLã®å–å¾—**: n8nã§ `Webhook` ãƒãƒ¼ãƒ‰ã‚’ä½œæˆã™ã‚‹ã¨ã€URLãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼ˆä¾‹: `http://xx.xx.xx.xx:5678/webhook/generate-image`ï¼‰ã€‚ã“ã‚Œã‚’GASã® `N8N_URLS` ã«ã‚³ãƒ”ãƒšã—ã¦ãã ã•ã„ã€‚
3.  **http vs https**: VPSæ§‹ç¯‰åˆæœŸã¯ `http` (æš—å·åŒ–ãªã—) ã®å ´åˆãŒã‚ã‚Šã¾ã™ã€‚GASã¯ `http` ã§ã‚‚é€ä¿¡å¯èƒ½ã§ã™ãŒã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£çš„ã«ã¯å°†æ¥çš„ã«SSLåŒ–æ¨å¥¨ã§ã™ã€‚
