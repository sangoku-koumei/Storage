# 徹底討論：AIマニュアル作成ツールの「お粗末さ」と「改善戦略」

**参加エキスパート:**
1.  **Agency Producer (Pro)**: 大手代理店出身。売れるクリエイティブと顧客体験に厳しい。「今のままじゃ素人の工作」と切り捨てる。
2.  **Lead AI Architect (Arch)**: AIモデルとシステム設計の専門家。堅牢性と拡張性を重視。
3.  **UX/UI Lead (Des)**: ユーザー体験と視覚的魅力を追求。StreamlitのデフォルトUIを嫌う。
4.  **Senior Developer (Dev)**: コード品質と保守性の鬼。スパゲッティコードを許さない。

---

## 1. Current Status Analysis (Weaknesses)

**Pro**: 正直に言うよ。ユーザーが「お粗末」と言ったのは痛いけど的確だ。現状のツールは「機能がつぎはぎされた実験室のプロトタイプ」に過ぎない。エージェンシーが顧客に見せられるレベル、あるいはエージェンシーがこのツールで作ったものを「成果物」として高単価で売れるか？答えはNOだ。

**Des**: 同感。まずUIが「文字、文字、文字」で圧迫感がすごい。ボタンを押すたびに画面がチラついて（rerun）、どこを見ていいかわからない。マンガモードやLPモードと言いながら、プレビューエリア以外は無機質なフォームの羅列。クリエイティブな気分になれないわ。

**Dev**: コードも限界だね。`app.py` にロジックもUIも全部詰め込まれて、機能追加（PDFアップロードとか）のたびに `IndentationError` や `SessionState` エラーが出ている。これは「壊れやすい家」を建て増ししている状態。アーキテクチャの刷新が必要だ。

**Arch**: 機能面でも「繋ぎこみ」が甘い。PDF読み込み、URL抽出、リサーチ...これらが単にテキストエリアに追記されるだけというのは芸がない。「どの情報を重視するか」「情報の粒度」を整理せずにLLMに投げれば、出力もボヤけたものになる。`gpt-4o-mini` は速いけど、複雑な文脈統合には `gpt-4o` などの上位モデルを局所的に使うなどのメリハリも必要かもしれない。

---

## 2. 徹底改善：Agency Gradeへの道

### A. UI/UXの刷新 (脱・管理画面感)

**Des**:
*   **プログレスバーとステップの視覚化**: 今どこにいて、あと何が必要かをグラフィカルに見せる。
*   **リアルタイムプレビューの強化**: 最終工程まで行かないと見れないのはダメ。入力したそばから「なんとなくこういう構成になりそう」というドラフトが右側に出続けるような体験。
*   **カスタムCSS**: Streamlitの標準デザインを上書きして、もっと「ツール感」を消す。ダークモードベースで、アクセントカラーを使ったプロフェッショナルな配色に。

### B. アーキテクチャの再設計 (堅牢性)

**Dev**:
*   **コンポーネント分割**: `app.py` はエントリーポイントだけにして、`views/input_view.py`, `views/editor_view.py` のように画面ごとにファイルを分割する。
*   **状態管理クラス**: `st.session_state` を直接いじるのではなく、`StateManager` クラスを作って、状態の更新を一元管理する。これで「初期化忘れ」や「更新タイミングの手違い」を防ぐ。
*   **エラーハンドリングの強化**: ユーザーに生のエラーログ（Traceback）を見せてはいけない。親切なエラーメッセージとリカバリー手順を表示するラッパーを作る。

### C. クオリティ・コントロール機能 (プロの仕事)

**Pro**:
*   **「中間レビュー」の高度化**: いきなりHTMLを作る前に、「構成案（目次）」の段階でもっと細かく編集させたい。今はテキストエリアでいじるだけだけど、項目をドラッグ＆ドロップで並べ替えたり、要素を追加したりできるUIが欲しい。
*   **トンマナ管理**: 「硬め」「親しみやすく」「高級感」といったパラメータをもっと効かせる。
*   **画像の扱い**: 今の実装（生成して挿入）は良い一歩だけど、画像のスタイル統一機能や、生成された画像のリテイク機能をもっとスムーズに。

**Arch**:
*   **データの構造化**: 入力された情報を単なるテキストの塊として扱わず、「背景」「ターゲット」「ゴール」「必須要素」といったタグ付きの構造化データとして保持し続けるべき。RAG (Retrieval-Augmented Generation) 的なアプローチで、長いPDF資料から必要な部分だけをピンポイントで参照させる仕組みも検討。

---

## 3. 具体的なアクションプラン

**Pro**: よし、まずは「見た目」と「安定感」だ。ユーザーに「お、変わったな」と思わせる必要がある。

1.  **緊急リファクタリング**: `app.py` の分割とステート管理の整理。エラーを撲滅する。(Dev)
2.  **UIオーバーホール**: `streamlit-option-menu` などのコンポーネント導入やカスタムCSSで、モダンなアプリのような見た目にする。(Des)
3.  **編集プロセスのUX改善**: テキストエリア修正ではなく、構造化されたエディタ（ブロックエディタ風）の導入を検討。(Des/Dev)

**Dev**: 了解。まずは今のスパゲッティを解くところからだね。
**Des**: 私はCSS注入で見た目を整えるわ。
**Arch**: 私は`generator.py`のプロンプトエンジニアリングを見直して、アウトプットの質を底上げする。

---

この方向性で、まずは**「コードのリファクタリング（安定化）」**と**「UIのモダン化」**に着手しませんか？
ユーザーは機能の多さよりも、「使っていて気持ちいい」「安心して使える」ツールを求めているはずです。
