# 文字化け対応ツール 使い方ガイド

## 概要
このツール群は、Gitやファイルの文字化け問題を解決するためのツールです。

## ツール一覧

### 1. fix-git-encoding.ps1
**Gitの文字化けを防ぐ設定を行う**

Gitのエンコーディング設定を最適化して、日本語ファイル名やコミットメッセージの文字化けを防ぎます。

**使い方:**
```powershell
.\git-auto-tools\fix-git-encoding.ps1
```

**設定内容:**
- `core.quotepath = false` - 日本語ファイル名を正しく表示
- `i18n.commitencoding = utf-8` - コミットメッセージをUTF-8に
- `i18n.logoutputencoding = utf-8` - ログ出力をUTF-8に
- `core.autocrlf = false` - 改行コード自動変換を無効化（Windows）

**注意:** この設定は新しいコミットにのみ適用されます。既存のコミット履歴の文字化けは修正されません。

---

### 2. detect-encoding.ps1
**ファイルの文字コードを検出する**

指定されたファイルの文字コード（エンコーディング）を検出します。

**使い方:**
```powershell
.\git-auto-tools\detect-encoding.ps1 -FilePath "ファイルパス"
```

**例:**
```powershell
.\git-auto-tools\detect-encoding.ps1 -FilePath "README.md"
```

**出力例:**
```
ファイルの文字コードを検出中...
ファイル: README.md

検出された文字コード: UTF-8 (BOMなし)

ファイルサイズ: 2048 バイト

✓ 文字コードは適切です（UTF-8）
```

---

### 3. convert-to-utf8.ps1
**ファイルをUTF-8に変換する**

指定されたファイルをUTF-8（BOMなし）に変換します。Shift_JISやEUC-JPなどの他の文字コードから変換できます。

**使い方:**
```powershell
.\git-auto-tools\convert-to-utf8.ps1 -FilePath "ファイルパス" [-Backup]
```

**パラメータ:**
- `-FilePath` (必須): 変換するファイルのパス
- `-Backup` (オプション): 変換前にバックアップファイル（.bak）を作成

**例:**
```powershell
# バックアップなしで変換
.\git-auto-tools\convert-to-utf8.ps1 -FilePath "作業メモ.md"

# バックアップ付きで変換（推奨）
.\git-auto-tools\convert-to-utf8.ps1 -FilePath "作業メモ.md" -Backup
```

**注意:** 
- 変換前の文字コードを自動検出しますが、正確でない場合があります
- 重要なファイルは必ず `-Backup` オプションを使用してください

---

### 4. fix-corrupted-files.ps1
**文字化けファイルを検出・修復する**

指定されたディレクトリ内のMarkdownファイル（.md）をスキャンし、文字化けの可能性があるファイルを検出・修復します。

**使い方:**
```powershell
# 検出のみ（推奨：まずこれで確認）
.\git-auto-tools\fix-corrupted-files.ps1

# 自動修復を実行
.\git-auto-tools\fix-corrupted-files.ps1 -AutoFix

# 特定のディレクトリを指定
.\git-auto-tools\fix-corrupted-files.ps1 -TargetDir ".\特定フォルダ" -AutoFix
```

**処理内容:**
1. 指定ディレクトリ内のすべての.mdファイルを検索
2. 各ファイルの文字コードをチェック
3. 文字化けの可能性があるファイルをリストアップ
4. `-AutoFix` が指定されている場合、自動的にUTF-8に変換

**出力例:**
```
==========================================
  文字化けファイル検出・修復ツール
==========================================

対象ディレクトリ: C:\Users\user\Desktop\storage_work

Markdownファイルを検索中...
  検出されたファイル数: 64

==========================================
  検出結果
==========================================

文字化けの可能性があるファイル: 2 件

  [×] C:\Users\user\Desktop\storage_work\file1.md
      理由: Shift_JISとして保存されている可能性

  [×] C:\Users\user\Desktop\storage_work\file2.md
      理由: UTF-8として読み込めない
```

---

## 推奨ワークフロー

### 初回セットアップ
1. **Gitの文字化け設定を修正**
   ```powershell
   .\git-auto-tools\fix-git-encoding.ps1
   ```

2. **既存ファイルの文字化けを確認**
   ```powershell
   .\git-auto-tools\fix-corrupted-files.ps1
   ```

3. **問題があれば修復**
   ```powershell
   .\git-auto-tools\fix-corrupted-files.ps1 -AutoFix
   ```

### 日常的な使用
- 新しいファイルを作成する際は、UTF-8（BOMなし）で保存してください
- ファイルが文字化けしている場合:
  ```powershell
  # まず文字コードを確認
  .\git-auto-tools\detect-encoding.ps1 -FilePath "ファイル名.md"
  
  # UTF-8に変換（バックアップ付き推奨）
  .\git-auto-tools\convert-to-utf8.ps1 -FilePath "ファイル名.md" -Backup
  ```

---

## トラブルシューティング

### Q: Gitのコミットメッセージが文字化けする
**A:** `fix-git-encoding.ps1` を実行してください。

### Q: ファイル名が文字化けして表示される
**A:** `fix-git-encoding.ps1` で `core.quotepath = false` が設定されているか確認してください。

### Q: ファイルの中身が文字化けしている
**A:** 
1. `detect-encoding.ps1` で文字コードを確認
2. `convert-to-utf8.ps1` でUTF-8に変換

### Q: 変換後も文字化けが残る
**A:** 
- 元のファイルの文字コードが正しく検出されていない可能性があります
- バックアップから手動で文字コードを指定して変換する必要があるかもしれません
- テキストエディタ（VS Code、Cursorなど）で「エンコードを指定して開く」機能を使用して確認してください

---

## 注意事項

- **バックアップを取る:** 重要なファイルを変換する前に必ずバックアップを作成してください
- **既存のコミット履歴:** これらのツールは既存のGitコミット履歴の文字化けを修正しません。新しいコミットから文字化けが改善されます
- **複数ファイルの変換:** `fix-corrupted-files.ps1` を使用すると、一度に複数ファイルを処理できます

